sudo: required
language: ruby
services:
  - docker
script:
  - rake test:integration
jobs:
  include:
    - env: TARGET=x86_64-linux
    - env: TARGET=i686-linux
      if: tag IS present
    - env: TARGET=armhf-linux
      if: tag IS present
    - env: TARGET=x86_64-linux
      if: tag IS present
    - env: TARGET=i386-linux
      if: tag IS present
branches:
  only:
    - master
    - /v\d+\.\d+\.\d+/

before_deploy:
  - rake "release:build:${TARGET}"
  - rake release:compress
  - sudo chown "$USER" mitamae-build/*
deploy:
  provider: releases
  api_key:
    # This is generated by `travis setup releases`
    secure: rrUgvmoom+vPrHOGRkioIYw0xc5kaqoELWbsm4rKcsATR6ZeIJ42IGHoez3VL/2oo8N9PFa2q4nkkMB+dQAraFguGAtPhd/pIZKruL5Kzpv5Ku3ikBOT5KArG9b9ua0h2dcIjntMaUh+ODgSWxJREl4Z1MGP3KIU4/bJhP6yzvmv7/MAFkAj8KqNk0xtw5Z92F7Sr8sEfNqTRHZSs6kQPNr68wpnuPcB5NbP1PTKNMFkMwbRqzTGfB3qUF6A4UYDiI1Ep6xdOpbzPXE+cNV6fGwMX4EVo1qazPlO8tlwZiricihnD/0hnEVl37f4vMYMNK2djlv7hI7EFaeQuSTzoierLJd6smFH7muWNwGmeRlbVc7owdspkujQEe0LHSY8whnnaOArNkG7a5hBzr8OffH6nRZ4tTi6aDYpgYHOhHkNsZgDE4WbCAFxOkoNekzpXGkryewFTqP0GdRv0v52Yw03kjf9q5/95PmBa2LAsjOWD/ZrwqJ+qbjUiF9UQqrpIAfoq5DIAP5VCefEMKlGA5gD5ixkjfoYBYcOyMPUAn5PYj9DIdojXAnQbX6VnMX5VD8G26e/fCQRdRi0hjhXIi35IbIwUzHn9iIKnTNWFZgzLWB9huQzG+I9YlR+ggYt8u9w8BN7o3oWH7VuKvVia6rRkDXHxwpVNqd0ZsVlW5c=
  file_glob: true
  file: mitamae-build/*
  skip_cleanup: true
  on:
    repo: itamae-kitchen/mitamae
    tags: true
